[TOC]

## 1 概念与思维

推荐系统就是用已有的连接去预测未来用户和物品之间将会出现的连接。建立连接时，用户之间、物品之间、用户和物品之间，都形成网络，直到网络形成长尾作用，推荐系统才能发挥作用

### 预测问题模式

#### 评分预测

预测连接的强度（预测用户消费体验）。常见于点评类产品（书影音），属于显式反馈

缺点

* 数据收集不易。用户需要从看到一直到消费完成并给出评分
* 数据质量不能保证。伪造数据门槛低，真实数据收集不易，门槛高（？？？不通）
* 数据不稳定，评分在不同时期差别大

#### 行为预测

预测是否会产生连接（预测用户是否会完成消费），隐式反馈，利用隐式反馈数据预测隐式反馈发生的概率。从登陆到购买收藏，都是用户行为，数据量比显式反馈多很多，

常见两种预测方式：

1. CTR（点击率）预估：直接预测行为本身发生的概率。点击率可引申到收藏，购买等行为
2. 预测物品的相对排序

隐式反馈优点：1)数据稠密。2)蕴藏了更多用户兴趣。3）常常和产品指标挂钩，容易做AB实验，容易与模型的目标函数关联

给出高评分的先决条件是用户要有评分行为，所以行为预测解决推荐系统80%的问题，评分预测解决最后20%的问题。（？？？）

### 顽疾

没有通用解决方案，不容易被重视的问题

* 冷启动：新用户或不活跃用户、新物品或展示次数少的物品，缺乏相关数据
* 探索与利用（EE）问题：假设已经知道用户喜好，如何平衡用户感兴趣的内容和探索用户新的兴趣
* 安全问题：系统被攻击可能造成的影响：给出不可靠的推荐结果、收集了不可靠的脏数据，难以完全消除

### 思维模式

四个关键元素需要注意，重要性依次递减

* UI和UE：颜值最重要
* 数据
* 领域知识：其他产品无法替代的部分（电商——价格，新闻——快）
* 算法：产品初期算法不重要，更重要的是产品和运营

目标思维：量化一切。量化目标，不能停留在“感觉很准”的层面，要设定一个数据目标，不断迭代来达到。要量化就要收集数据，得到结果。要有目标和约束，例如目标是点击率，多样性为约束，不能为了点击率不顾多样性，要设定一个阈值，让每次推荐排序在计算最佳排序的结果时，多样性的量化值不能低于阈值，在满足约束的情况下，目标值越大（小）越好，在产品的不同阶段，目标和约束可以互相切换

不确定性思维：用概率的眼光看待结果。推荐系统绝大多数算法都是概率算法，无法保证得到准确的结果，只能提高得到好结果的概率；如果为了一个很难出现的事件花时间修补，得不偿失；偶尔出现不可解释的推荐也是有益的，可以探索用户新兴趣。也不应该把一切bug归咎于不确定

## 2 产品漫谈

推荐系统是吸引注意力的重要手段

存储注意力：基于用户兴趣筛选信息流，重新排序展示，吸引注意力，防止注意力衰减（类似微博的关注，先把感兴趣的排在前面，而不是按时间显示）

## 3 内容推荐

### 用户画像

推荐系统的用户画像是给机器看的。推荐系统就是要在用户和物品之间建立连接，一般，对用户和物品之间的匹配来评分，预测用户评分或偏好，评分前，需要将物品和用户都表示成向量，才能计算，推荐算法不同，向量化的方式也不同，匹配评分的做法也不同

用户向量化的结果就是用户画像，所以向量化是必须做的。除了常见的用户资料、标签，还有各种深度学习得到的Embbedding向量，都是很好的画像内容

大型推荐系统的实现一般分为召回和排序两个阶段。全量物品数量庞大，无法为每个用户逐一计算每个物品的评分，这时需要召回阶段，预先筛选一部分物品，降低计算量，用户画像除了用于最终匹配，还用于召回。所以构建用户画像要以这两个阶段为目的

向量有两种

* 稀疏向量：标签、注册资料、社交关系。是显而易见的用户画像，可解释性更好，可以用来给出推荐理由。
* 稠密向量：通过训练神经网络得到的Embedding向量、通过矩阵分解得到的隐因子、浅层语义分析或者话题模型得到的话题分布等。能抓住更多隐藏兴趣，但黑盒子特点也导致了它的可解释性不如前者

建立用户画像的关键因素，向量的关键因素

* 维度（价格、种类、味道等维度）
  * 每个维度的名称都是可理解的。用户画像的价格维度和商品的价格维度是可以相对应相匹配的。将用户画像和物品同纬度相乘，可理解为用户画像这边的值是权重，给物品画像那边的值加权
  * 维度的数量：根据用户阅读历史挖掘兴趣标签，那么标签的种类数就是维度数，如果维度是一些Embedding向量，则维度数就是根据模型的结构来定的
  * 维度：维度数不是必须的，用户画像中稀疏向量的维度数可以不用提前确定。维度越多画像越精细，但是计算代价也越大，需要权衡。用户画像是向量化结果，不是标签化

* 量化：用户每个维度的量化都应该交给机器，主观量化是大忌，不要为了用户画像而用户画像，它只是推荐系统的一个副产品，应根据效果（排序好坏、召回覆盖等指标）指导用户画像的量化

用户画像的构建方法有以下3类

1. 查户口。个人信息、购买历史等作为画像内容，实现简单，但对于冷启动非常有用
2. 堆数据。堆积历史数据作统计工作，是最常见的用户画像获取方式，常见的兴趣标签就是这一类。先给物品打上标签，在获取用户在这些标签上的历史行为，从标签维度做数据统计，用统计结果作为量化结果
3. 黑盒子。用机器学习的方法，学习稠密向量。作用大，比如使用潜语义模型构建用户阅读兴趣，以及使用矩阵分解得到的隐因子或深度学习模型学习用户的Embedding向量。这一类用户画像数据因为不可解释，不能直接被人看懂

### 标签挖掘技术

早期的推荐系统一般都从基于内容的推荐系统做起，需要从内容本身挖掘用户兴趣标签

主要处理文本数据，用户端：

* 个人信息
* 产生的内容
* 与用户发生了连接关系的文本，如阅读记录

物品端：

* 标题、描述
* 物品本身的内容
* 物品基本属性中的文本

基础版本用户画像需要做的事：

1. 把所有非结构化的文本结构化、去粗取精，保留关键信息，构建高质量标签库

   覆盖面：标签库能覆盖的用户、物品越多越好

   健康度：量化标签平均覆盖物品的程度

   经济性：标签之间的语义相似性越小越好。两个有相同语义的标签却占据了两个兴趣向量的维度，性价比低

2. 根据用户资料、行为、内容，把标签传递给用户

   标签库是用户和物品共享的，因为标签库是为了给用户找到感兴趣的物品，所以不能用户和物品两遍各做一套

3. 定期更新

构建标签库分为两派

* 中心化：专业分类法（人工分类），这样的标签库表现为一个分类树，需要较多人员维护
* 去中心化：1）大众分类法，依靠用户贡献标签，比如豆瓣书影音标签。2）源于挖掘的标签：从非结构化的文本中抽取标签后构建标签库

| 对比维度       | 中心化         | 去中心化           |
| -------------- | -------------- | ------------------ |
| 标签覆盖面     | 小             | 大                 |
| 标签覆盖健康度 | 好（均匀）     | 不好（倾斜）       |
| 标签经济性     | 好（相对独立） | 不好（同义近义多） |

高质量的标签库需要两者结合使用。注意几点

* 不同角度构建专业分类体系（例如图片除了静态图片、动态图片等形式分类，还要有娱乐、体育等主题分类）
* 去中心化的标签要归一化，同义标签保留最常用的
* 去中心化的标签也需要专业人员把控质量

### 标签挖掘方法

结构化文本。利用NLP自然语言处理算法分析物品段的文本信息可得到：

* 关键词提取：最基础的标签来源，也为其他文本分析提供基础数据，常用TF-IDF和TextRank
* 实体识别：人物、位置、著作、影视剧、历史事件、热点事件等，常用基于词典的方法结合CRF（条件随机场）模型
* 内容分类：按照分类体系分类，用分类表达粗粒度的结构化信息
* 文本聚类：在无人制定分类体系的前提下，无监督地将文本划分成多个类簇。不是标签，但也是用户画像常用构成
* 主题模型：从大量已有文本中学习主题向量，再预测新的文本在各个主题上的分布概率。也是一种聚类思想。不是标签，但也是用户画像常用构成
* 嵌入：Embeddinng，从词到篇章，都可以学习其嵌入表达，可挖掘出字面意思之下的语义信息，并用有限的维度表达出来

#### 关键词提取

两种方法都是无需标注数据，属于无监督的方式

##### TF-IDF

