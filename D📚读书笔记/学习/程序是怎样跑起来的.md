[TOC]

#《程序是怎样跑起来的》
> “计算机组成原理”图解趣味版

## 第1章 对程序员来说CPU是什么

- CPU所负责的就是解释和运行最终转换成机器语言的程序内容

- 在CPU的四个构成部分中，程序员只需要了解寄存器即可，因为程序是把寄存器作为对象来描述的

## 第2章 数据使用二进制数表示的

## 第3章 计算机进行小数运算时出错的原因

- *计算机运算出错的原因：* 0.1累加100次后的结果是10。但是在C语言中运行的结构是10.000002。在计算机内部使用二进制来表示整数和小数的方法有很大不同。之所以会出现运算错误，是因为有一些十进制数的小数无法转换成二进制数

    |  二进制数  |  对应的十进制数  |
| --- | --- |
|  0.0000  |  0  |
|  0.0001  |  0.0625  |
|  0.0010  |  0.125  |
|   0.0011 |  0.1875  |
    二进制是连续的，十进制数是非连贯的，十进制数0的下一位是0.0625，这中间的小数就无法用小数点后四位的二进制数来表示。不管二进制数小数点增加多少位，都无法得到正确的结果，只会得到近似值，会变成无限循环的小数，计算机会根据变量**数据类型**所对应的长度将数值从中间截断或者四舍五入。

-  *什么是浮点数：*浮点数分为双精度浮点数（64位）和单精度浮点数（32位），由以下四部分构成
    **±m\*n<sup>e</sup>**
    ±为符号，m为尾数，n为基数（在计算机中都是二进制所以基数为2），e为指数

- *如何避免计算机出错：*计算机出错的原因有两种情况。1）采用浮点数来处理小数，2）因`位溢出`而造成计算错误的情况。两种避免方式：1）忽略，2）把小数转换成整数绝对不会出错，计算后再转换为小数，例如把0.1*10

## 第4章 熟练使用有棱有角的内存

- *指针：*理解指针的关键点就是要弄清数据类型这个概念。数据类型表示从指针存储的地址中一次能够读取的数据字节数    

- *数组是高效实用内存的基础：*数组是多个同样**数据类型**的数据在内存中连续排列的形式。数组和内存的物理构造是一样的

- *栈、队列以及环形缓冲区：*栈和队列都可以不通过指定地址和索引来对数组的元素进行读写，程序会更简单。队列一般是以环状缓冲区的方式来实现的，即`有棱有角的内存`

- *二叉树使数据搜索更有效：*二叉树是指在链表的基础上往数据中追加元素时，考虑到数据的大小关系，将其分成左右两个方向的表现形式。

- 数组是栈、链表、二叉树的基础

## 第5章 内存和磁盘的亲密关系

- DLL（Dynamic Link Library）：Windows中，在程序运行，可动态加载调用的函数和数据的文件

- 内存使用电流来实现存储，磁盘使用磁效应来实现存储

- *不读入内存就无法运行：*程序保存在存储设备中，通过有序地被读出来实现运行，这一机制称为**存储程序方式**。磁盘中存储的程序，必须加载到内存后才能运行。在磁盘中保存的原始程序是无法直接运心的，是因为负责解析和运行程序内容的CPU，需要通过内部程序计数器来指定内存地址，然后才能读出程序

- *磁盘缓存：*指把从磁盘中读出的数据存储到内存空间的方式。当需要读取同一数据时，就可通过磁盘缓存把内容读出，可大大改善磁盘数据的访问速度。现在，随着硬盘访问速度的大幅改善，磁盘缓存的效果也没有之前那么明显了

- *虚拟内存：*指把磁盘的一部分作为假想的内存来使用。磁盘缓存是假想的磁盘（实际是内存），虚拟内存是假想的内存（实际是磁盘）。多个应用可以共有同一个DLL文件，可以达到节约内存的效果。DLL还有一个优点就是，在不变更exe文件的情况下，指通过升级DLL文件可以更新

## 第6章 亲自尝试压缩数据

- *RLE算法：*把文件内容用`数据 x 重复次数`的形式来表示压缩方法，经常被用于发送黑白图像的传真。例：`AAAAAABBCDD — A6B2C1D2`。但是在实际情况中多次重复的情况并不多。适合相同数据经常出现的图像、文件，不适合文本的压缩。机制简单，算法简单
    
    |  文件类型  |  压缩比率  |
| --- | --- |
|  文本  |  199%  |
|  图像  |  40%  |
|  EXE  |  62%  |

- *哈夫曼算法：*多次出现的数据用用小于8位的字节数来表示，不常用的数据用超过8位的字节数来表示。 例：A出现100次，Q出现3次。A和Q都用8位来表示时，原文件的大小就是100 * 8 + 3 * 8 = 824位，假设A用2位，Q用10位，压缩后位100 * 2 + 3 * 10 = 230位。需要注意的是，不管超过8位的数据，还是不满8位的数据，最终都要以8位为单位保存到文件中，因为磁盘是以字节（8位）为单位来保存数据的。
    为各压缩对象文件分别构造最佳的编码体系，并以该编码体系为基础来进行压缩。用什么样式的编码对数据进行分割由各个文件而定。压缩过的文件中存储着哈夫曼编码信息和压缩过的数据。哈夫曼算法要使用哈夫曼树来构造。
    
    |  文件类型  |  压缩比率  |
| --- | --- |
|  文本  |  28%  |
|  图像  |  10%  |
|  EXE  |  19%  |

- *图像文件的数据形式：*Windows的标准图像数据形式为BMP（bitmap，使用Windows自带的画笔来做成的图像数据形式），完全未压缩。其他的JPEG、TIFF、GIF都会对数据进行压缩

- *可逆压缩和非可逆压缩：*能还原到压缩前的状态为可逆压缩（EXE、文本文件都必须抱保证数据在还原后和压缩前完全相同），JPEG为非可逆压缩，GIF虽然为可逆压缩，但是因为有色数不能超过256色，还原后颜色信息会又一些缺失，所以导致了图像模糊

- 压缩算法有一二十种，压缩比率、压缩需要的时间以及各种文件的需求都不同

## 第7章 程序是在何种环境中运行的

- 机器语言的程序称为**本地代码**（native code）。C语言等编写的程序为源代码。通过对源代码的编译就可得到本地代码。软件包就是本地代码而非源代码

## 第8章 从源代码到可执行文件

- *本地代码：*CPU能直接解析并运行的是本地代码的程序，不是源代码。计算机是把所有的信息作为数值的集合来处理的。把EXE文件Dump一下（把文件内容的每个字节用2位16进制来表示），每个数值都表示一个**命令**或**数据**。例：16 C7 45 C8 0A 00

- 把源代码转换为本地代码为编译，以Windows下的C为例，编译后得到后缀为.obj的目标文件（object file），还无法运行。把多个目标文件结合，生成一个EXE文件的处理就是链接，运行连接的程序叫链接器

- *DLL：*Windows中，API的目标文件不是存储在通常的库文件中，而是存储在名为DLL文件的库文件中，是程序运行时动态结合的文件。.lib文件中仅储存两个信息：1）某个API在某个DLL中，2）储存着DLL文件的文件夹信息，把这样的lib库文件称为导入库。存储着目标文件的实体，并直接和EXE文件结合的库文件称为**静态链接库**

- *编译器和解释器：*编译器是在**运行前**对源代码进行解释。解释器在**运行时**对源代码的内容一行行进行解释处理的

- *Build：*根据开发工具种类的不同，有的编译器可通过Build菜单直接生成可执行文件，这里Build指连续执行编译和链接

## 第9章 操作系统和应用的关系

- *系统调用：*提供操作系统硬件控制功能的函数

- 高级编程语言的机制就是，使用独自的函数名，然后再编译时将其转换成相应操作系统的系统调用

- *系统软件：*网络功能和数据库功能，虽不是操作系统本身不可欠缺的功能，但因为和操作系统很接近，所以被称为中间件而不是应用。操作系统和中间件和在一起，称为**系统软件**。应用不仅可以利用操作系统，也可以利用中间件的功能

## 第11章 硬件控制方法

- 控制硬件借助的就是输入（IN）和输出（OUT）指令。IN通过指定端口号的端口输入数据，并将其存储在CPU内部的寄存器中，OUT吧CPU寄存器中存储的数据，输出到指定端口号的端口

- *I/O控制器：*交换计算机主机同外围设备之间电流特性的IC

- *端口：*I/O控制器中有用于临时保存输入输出数据的内存，这个内存就是端口。各端口之间通过**端口号**区分，也称为**I/O地址**

- *寄存器：*I/O控制器内部的内存。和CPU的寄存器在功能上不同。CPU的寄存器用来进行数据运算处理，I/O寄存器用来临时存储数据

- *中断请求IRQ：*用来暂停当前正在运行的程序，并跳转到其他程序运行的机制。在硬件控制中相当重要，如果没有IRQ，可能出现无法顺畅进行的情况。CPU接收到中断请求后，会吧当前正在运行的主程序中断，并切换到中断处理程序，中断处理程序把CPU所有寄存器的数值保存到内存的栈中，当处理完后，再把栈中保存的数值还原到CPU寄存器中，继续对主程序的处理

- *DMA：*不通过CPU的情况下，外围设备直接和主内存进行数据传输，因为CPU作为中介的时间被节省了，所以可在短时间内传送大量数据，硬盘等用到了这个机制
                      