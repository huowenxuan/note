```javascript
'use strict';
import {StatusBar,Platform,Alert} from 'react-native'
import queryString from 'query-string'

var request = {};

function filterState(res) {
  setStatusBarNetworkActivityIndicator(false)
  if (res.status >= 200 && res.status < 300) {
    return res
  } else {
    let error = new Error(res.statusText);
    error.res = res;
    error.type = 'http';
    console.log(error)

    let errorMessage = null
    if (res && res._bodyInit) {
      errorMessage = eval('(' + res._bodyInit + ')')
    }

    throw errorMessage;
  }
}

function filterNoContent(res) {
  if (res._bodyInit && typeof JSON.parse(res._bodyInit) === 'object') {
    return res.json()
  } else {
    return res._bodyInit
  }
}

function filterResultCode(res) {
  if (res.resultCode && res.resultCode != 0) {
    console.log(res.message)
    throw res.message
  } else {
    return res
  }
}

function setStatusBarNetworkActivityIndicator(visible:boolean) {
  if (Platform.OS == 'ios') {
    StatusBar.setNetworkActivityIndicatorVisible(visible)
  }
}

function logAPIandParam(url, param, type) {
  console.log(`\nurl:${url} \nparam:${JSON.stringify(param)}\ntype:${type}`)
}

request.post = function (url, body) {
  let fetchOptions = {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  };

  logAPIandParam(url, body, 'post')
  setStatusBarNetworkActivityIndicator(true)
  return fetch(url, fetchOptions)
    .then(filterState)
    .then(filterNoContent)
    .then(filterResultCode)
};

// get请求没有body
request.get = function (url, query) {
  if (query) {
    url += `?${queryString.stringify(query)}`
  }

  logAPIandParam(url, query, 'get')
  setStatusBarNetworkActivityIndicator(true)
  return fetch(url)
    .then(filterState)
    .then(filterNoContent)
    .then(filterResultCode)
};

request.delete = function (url, body) {
  if (body) {
    body = JSON.stringify(body)
  }

  let fetchOptions = {
    method: 'DELETE',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body
  };

  logAPIandParam(url, body, 'delete')
  setStatusBarNetworkActivityIndicator(true)
  return fetch(url, fetchOptions)
    .then(filterState)
    .then(filterNoContent)
    .then(filterResultCode)
};

request.put = (url, body, path)=> {
  let fetchOptions = {
    method: 'PUT',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  };

  if (path) {
    url += `/${path}`
  }

  logAPIandParam(url, body, 'put')
  setStatusBarNetworkActivityIndicator(true)
  return fetch(url, fetchOptions)
    .then(filterState)
    .then(filterNoContent)
    .then(filterResultCode)
}

module.exports = request;
```
