## 03.17

验证码登录api

画封面，研究pdf绘制富文本

部署

容器内访问宿主机的方法

TODO

找字体

部署

微信登录

## 03.16

合并分页算法完成，修改绘制方法

封装mongoose findOne，可排序（通过find+limit实现）

创建包月订单、查询用户是否包月、购买时候判断用户如果是包月就直接生成PDF

查询用户信息接口，返回是否包月

测试消息队列任务的重试，继续优化：捕获的程序错误失败任务也标记为done，否则会无限循环重试报错。重启应用导致中断的任务会自动重试+失败重试

绘制部分封面，需要继续优化（文字居中、绘制用户名等）

## 03.13

修改基础订单表，支持书订单和包月订单，不再单独创建各自的订单表

接入微信支付、书的订单生成与支付、订单超时关闭

支付回调更新订单并开始生成书，支付流程跑通，完成模拟支付成功api

封装生成支付参数方法，不需支付时直接开始任务

TODO：

​	包月业务、书订单区分包月和一次性购买

## 03.12

每次应用重启都重试所有失败任务，每隔30分钟重试

记录pdf大小

批量定时删除文件 的消息队列任务

删除书

修改schema创建方法，每个字段缺省值默认为null

建立基础订单表

## 03.11

修复docker无法递归创建目录的bug，增加封面图

修改七牛sdk源码，修改上传超时时间

研究mongoose事务

研究消息队列最多任务数

## 03.09

修改生成书api与逻辑，一篇帖子对应一本书，生成和修改都使用前端提供的分页数据，增加了计算完成的中间状态。数据库兼容一本书对应多篇帖子的情况

书的详情api，返回了计算分页数据，重写计算生成排名的方法

api:

1. 用户生成书列表
2. 专集列表
3. 专集帖子列表

