# 存储过程
存储过程是一组相关联的SQL语句，通常被称为函数和子程序，能够让程序员更轻松和灵活地编程。这是因为存储过程与一系列单个SQL语句相比更容易执行。存储过程可以嵌套在另一个存储过程里，也就是说存储过程可以调用其他存储过程，后者又可以调用另外的存储过程，依此类推。
利用存储过程可以实现过程化编程。基本的SQL语句只是告诉数据库需要做什么，而不是如何去做。而通过对存储过程进行编程，我们就可以告诉数据库发动机如何处理数据。
存储过程是保存在数据库里的一组SQL语句或函数，它们被编译，随时可以被数据库用户使用。存储函数与存储过程是一样的，但函数可以返回一个值。
函数由过程调用。当函数被过程调用时也可以传递参数，函数会进行所需要的计算，并且把一个值返回给调用它的过程。
当存储过程被创建之后，组成它的各种子程序和函数都保存在数据库里。这些存储过程经过了预编译，可以随时由用户调用

**与单个SQL语句相比的优点**
* 存储过程的语句已经保存在数据库里了
* 存储过程的语句已经被解析过，以可执行格式存在
* 存储过程支持模块化编程
* 存储过程可以调用其他存储过程和函数
* 存储过程可以被其他类型的程序调用
* 存储过程通常具有更好的响应时间
* 存储过程提高了整体易用性

```sql
# 创建
create procedure new_pro
(id in varchar2, desc in varchar2, cost in number)
as 
begin
    insert into pro_tbl
    values (id, desc, cost);
    commit;
end;

# 执行
call new_pro('1234', 'aaaaaa', 2.30);
```

## 触发器
触发器是数据库里编译了的SQL过程，基于数据库里发生的其他行为来执行操作。它是存储过程的一种，可以在 INSERT、DELECT或UPDATE语句之前或之后执行，可以在这些语句之前检查数据完整性，可以回退事务，可以修改一个表里的数据，可以从另一个数据库的表里读取数据

会导致更多的I/O开销，如果在使用存储过程或程序能够早较少的开销下完成同样的工作，就应该尽量不使用触发器

触发器的内容不能修改，只能创建和删除

```sql
# 创建
create trigger emp_pay_trig
agter update on emp_pay_tbl
for each row /* 在SQL语句影响每条记录都触发。执行了一条影响100行的SQL语句时，触发器会执行100次，如果省略掉，只会执行一次 */
begin/after
    insert/delete/update into emp_pay_histroy
    (id, rate, date, type)
    values
    (:new.id, :old.rate, :new.rate,
     :new.date, 'pay change');
end;

# 删除
drop trigger emp_pay_trig
```

