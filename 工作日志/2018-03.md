------

## 3.12 
### -11.49 
创建成员加入审核接入API完成。

成员管理页审核列表接入API完成，完成UI，因为这个列表中的信息不是成员信息，所以要加很多区分

### -16.35 
管理成员中的审核功能完成。审核完成后实时更新成员列表和成员数量

> 把event分支的新管理页面复制到review分支，免得将来冲突太多不好解决。


### -18.30 
完成圈子专属二维码下载

消息的通知页面、数量完成


------

## 3.9 
### -9.39 
在postman中测试代理IP，确实很慢，有些也会出错，说明昨天的代码是正确的，需要重新找IP

### -11.14 
查询并测试了很多代理IP网站的免费IP、套餐价格，基本一年最少2000，便宜的套餐有效IP基本和免费的差不多，仅有十分之一左右有效的IP。

先多找几个免费IP的网址，分别爬取，爬取到的IP去重、检验后存到redis中；redis中的IP每过10分钟检测一次，如果存活量少于10个，就再爬。IP自检比爬的过程中再检查效率和成功率都高

> 还有一个策略：**在APP中爬取，使用用户的IP，爬虫代码写在APP中**

### -18.40 
自己实现了自检的IP池

* 不够10个就一直获取，每次获取到都会检查IP是否可用
* 每隔十分钟都自检一次IP池
* 每次使用IP时，都循环IP池使用下一个IP，达到循环利用，这样只要IP可用，就可以实现无限循环了，但是一般只能用很少一段时间。
* 每当爬取出错，就把这个IP从IP池销毁，再使用下一个IP，当IP不够，又会再次补充

大多数情况下获取到10个IP，只有1个可用，还经常超时，需要验证码。但是买了高级的套餐，成功率达到百分之五十就会很稳定了


------

## 3.8 
### -13.56 
把superagent换成axios，star多，自带proxy，superagent的第三方superagent-proxy才87star不敢，而node-http-proxy是配合node原生http使用的，还是喜欢封装过的Promise类型的axios。

把其他网络请求都修改为Promise方式，代替callback。因为node6还不支持async/await所以在循环执行Promise时遇到了问题，错误的使用了Promise.all（因为是并发异步，并不能保证顺序执行），使用bluebird和q也没找到合适的方法

### -14.24 
自己实现了同步依次执行Promise数组的方法，返回每次的结果返回的数组，每当有一个错误都会直接catch

```js
/**
 * 按照顺序同步依次执行每个promise
 * 返回每次的结果组成的数组，每当有一个报错都会直接catch
 * @param values
 * @return {Promise<any>}
 */
function syncPromise(values) {
  let response = []
  let idx = 0
  return new Promise((resolve, reject) => {
    (function next() {
      values[idx]().then((res) => {
        response.push(res)

        if (idx < (values.length - 1)) {
          idx++
          next()
        } else {
          resolve(response)
        }
      }).catch((e) => reject(e))
    })()
  })
}
```

### -15.52 
代理IP池封装完成，自动刷新IP池，获取下一个IP。只暴露了两个方法IP()和nextIP()，在访问失败时调用nextIP()，其他刷新赋值等操作会在nextIP()中自动完成

> 如果没有IP池子就获取IP池，IP设置为IP池的第一个
> 如果当前IP失效，就从IP池获取下一个IP，如果获取的是IP池最后一个，就刷新IP池，再从第一个开始使用

### -18.24 
使用axios的proxy很慢很慢，而且各种各样的错误，买了两种试用套餐的IP也不行，使用了tunnel.httpsOverHttp构建proxy后感觉没成功，还是使用本地访问，没有走代理，还需要找别的办办法


------

## 3.7 
### -10.46 
彻底解决微信分享图片过大的问题，问题出在压缩的方法`UIImageJPEGRepresentation`，不一定会压缩到想要的范围，宽图是可以压缩的，长图往往会分享失败，所以要先切割图片，根据小程序的图片宽高比为1.25:1来切割，百度找了半天都是一样的方法，都是压缩变形，不是直接切割，Google一下就找到了

```
CGImageRef ref = CGImageCreateWithImageInRect(image.CGImage, CGRectMake(0, 0, image.size.width, image.size.width / 1.25));
image = [UIImage imageWithCGImage: ref];
CGImageRelease(ref);
```

> 使用原生时，reject后总会警告`unknown error from a native module`，需要添加.catch(()=>{})，catch的方法不能为null


### -12.55 
node抓取搜狗微信搜索结果页成功，获取到结构化的微信号、名字、详情页链接、头像、二维码、功能介绍。

找到node代理库https://github.com/nodejitsu/node-http-proxy，8k多star

### -14.1 
node抓取搜狗微信的微信认证、最近文章，组成数组；还获取到总数、本页总数、当前页数。开始无限循环暴力爬取，测试代理IP

### -16.7 
1. 搜狗微信的反爬机制是如果调用多次，会弹出二维码，尝试用node获取二维码然后模拟浏览器提交，不成功，不知道除了Form Data以外还需要什么别的参数。过十分钟左右就可以继续访问了
2. 同一IP，代码中不带cookie可以爬十多次，然后就需要二维码，但是用浏览器还是可以访问，使用浏览器发送的Cookie放在代码中又可以访问了，但是再爬十多次后连浏览器也不行了。了解了一下cookiejar，好像并不能帮到我
3. 只能尝试代理IP池了

### -16.56 
整理代码，提取公共方法和参数

### -18.48 
爬取 https://www.kuaidaili.com/free 的代理IP列表，先获取3页，隔1秒获取一页，最终获取到48个IP


------

## 3.6 
### -10.7 
android保存图片设置权限成功。

### -10.29 
打开和话题详情页打开大图可下载图片

### -10.48 
拒绝报名时弹出alert

### -12.0 
mm-ionic搜索note，API和简单的页面

### 14.0-15.0 
开会

### 13.30-15.40 
打卡页面修改完成

### -16.7 
mm-ionic搜索的分页、排序、点击完成，显示一行时间和text

### -17.32 
因为打开分享没有网页，所以点分享后直接分享到微信好友，提取ShareLightBox的shareWithType方法到utils/Share中，可直接调用来分享打开到唯一平台

### -18.34 
研究微信分享图片压缩方法


------

## 3.5 
### -10.57 
成员管理加入待审核tab，无功能

### -11.43 
master分支和活动分支分开太久，冲突太多无法合并，所以cherry-pick每次commit


1. 合并分支 
    
    git rebase -i 不合并的commitId

2. 进入vim
    
    pick为所要执行的commitId，squash/s为要合并到前一个的commitId。所有的commit描述都会追加到要执行的commit描述之后

3. 修改

   git commit --amend  vim进入最近的commit，修改描述很简单


因为要链接用于下载文件、图片的原生库，原生有冲突就无法运行iOS程序，而且解决起来麻烦的要死。
所以分别在两个分支都link react-native-fetch-blob，后续的配置再合起来做

### -18.8 
iOS 实现保存图片到相册的功能

> react-native-fetch-blob并没有保存图片的功能，而且没有获取iOS相册路径的方法，android有，保存图片到android相册成功，但是在相册中显示不出来，查资料说是需要发送一个通知到intent，还是需要原生做

iOS保存图片到本地使用UIImageWriteToSavedPhotosAlbum如果没有权限会崩溃，而且无法获取到保存结果。所以使用更复杂的方法PHAssetChangeRequest，在没有相册权限时会弹出权限，但是同意后不会自动保存，所以自己做权限管理，同时避免意外闪退。

~~权限和保存分开为两个步骤：先判断权限，如果有权限直接保存；如果没询问过权限就请求权限，再保存；如果权限被拒绝就弹出提示，让用户打开权限~~

直接请求权限，进行保存

### -18.37 
android原生保存图片成功，在相册实时显示。还需要做android动态权限管理



------

## 3.2 
### -10.59 
alert input完成，支持传TextInput的参数

> 处理alert input键盘弹出滚动的高度与收回键盘，直接使用了KeyboardAwareScrollView，

### -11.12 
1. 加入圈子如果是需要审核，就弹出input alert，等有了api后直接接入发送一条消息个圈主就可以了。
2. 后台没必要记录用户是否已申请，微信和qq也没有记录，可以发送多条申请，想人性化一点就申请之后把加入置灰，显示已申请，等再次进入依然显示加入也是可以的
3. 搜索圈子详情页，状态栏变白

### -15.53 
消息加入通知页面，完成成员加入审核的状态

### -16.22 
修复报名信息不显示拨打电话按钮的bug，因为是通过中文标题判断的，之前标题是“电话”，修改后为“电话：”

修复百度地图地址获取失败的错误

> 更换网络请求库只有，没有过滤掉get请求data为空，url却有参数的情况，导致末尾是问号，会被当做是最后一个参数的一个字符

### -17.15 
开会

### -17.31 
打卡头像修复

研究react-native-fs和react-native-fetch-blob的优劣，用于操作文件、保存图片



------

## 3.1 

### -11.36 

查看小米推送接收不到的情况，后台一直显示发送中，没找到原因，已联系客服

### -17.8 

圈子创建和修改加入成员加入方式

### -17.52 

修复管理员退出圈子也会解散圈子，应该使用created_by

### -18.28 

搜索圈子加入时显示是否需要审核

封装Alert加输入框的UI

