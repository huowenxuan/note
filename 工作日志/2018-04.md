------

## 4.8 
### -11.26 
redux创建article的action和reducer，接入6个微信公众号相关的API

文章管理列表中显示公众号文章列表

### -11.59 
适配iPhone X，通过StatusBar.currentHeight只在android管用，在iOS上通过DeviceInfo.getModel获取机型是否为iPhoneX，然后把状态栏高度设置为74

### -15.24 
公众号文章管理列表UI完成，模仿微信历史消息页面

### -16.24 
爬取到的文章html过滤掉所有\n、\t

> 之前做公众号文章爬取，处理音乐时加入了自己的html代码和播放的script等，现在去掉了里面的/t、/n，相当于压缩代码，去掉之后无法正常播放，因为里面含有//注释，应该把`//`都改为`/**/`，然后补齐所有的分号

### -17.16 
从微信获取到的文章内容都是`&#xAAAA`的格式，称为NCR，为16位的，把它们转换为正常显示的中文或英文，并兼容10位NCR

```
.replace(/&#x([a-zA-Z0-9]+);/g, (_, $1) => String.fromCharCode(parseInt($1, 16))) // 处理16位
.replace(/&#(\d+);/g, (_, $1) => String.fromCharCode($1)) // 处理10位
```

### -17.37 
同步一篇公众号文章、展示详情完成

### -18.0 
微信文章一次上传多个成功

尝试多选上传，只选了两个就报错413  `request entity too large`，所以只能依次上传，好处是依然可以多选，而且不用限制每次选择的数量，在失败时也不需要询问是否重试，因为上传成功的还会再次检查一次是否上传过

### -18.25 
依然遇到了一篇文章太长无法上传的问题，只能提示文章过长无法上传

> 优化网络请求的错误处理，之前只是把错误信息输出出来，返回一个简单的中文message，现在直接返回输出的内容，可以获取到英文的错误信息，根据这个错误信息判断`includes('request entity too large')`


------

## 4.4 
### -11.20 
集成react-navigation成功，以前失败了两次都是在集成redux失败的，今天才发现redux并不是必须的，甚至是官方不推荐的。

react-navigation依然有我受不了的问题

1. props只能通过this.props.navigation.params获取，但是幸好社区有[react-navigation-props-mapper](https://github.com/vonovak/react-navigation-props-mapper)，通过高阶组件的方式把这些params赋值给this.props。实现：直接在containerWrapper外层套一个withMappedNavigationProps()，即可在所有container中获取到props
2. 所有导航方式都需要事先确定好，有待研究

实现了在Router.js中统一管理跳转，react-navigation除了在组件中通过this.props.navigation.navigate的方式跳转，还支持在非组件方法中进行跳转

实现方式：在app入口中获取到navigation的ref，保存到Router中的一个变量里，直接通过这个ref来进行导航`_navigator.dispatch(NavigationActions.push())`

### -12.1 
将所有页面都改成react-navigation风格

完成首页的初始化，根据不同的状态加载不同的初始页面，不在TopicPage中判断状态再reset了，直接在appjs中配置initRouteName

### -14.54 
实现reset，reset提供了几种参数方式，第一种是通过key和routeName，key是随机的，不好获取；采用第二种方式：index=0和actions=routeName

实现popToTop，自带，RNRF是没有的，只能pop回固定的routeNamef

实现popN，依然是多次pop，并没有popNumber，popToRouteName等方法

发布页Overlay套用了containerWrapper，因为containerWrapper外层套一个withMappedNavigationProps()，在Overlay中无法获取到navigation，react-navigation-props-mapper有bug，没有判断navigation不存在的情况，报空指针异常，自己实现params赋值给props，很简单

react-navigation集成完成，性能较RNRF提升不少，在几个转换卡顿的页面没有再出现卡顿的现象，有可能是因为没有集成redux，也有可能少了很多中间setState操作

### -16.35 
合并nav、file、wechat分支

Router中所有跳转从普通函数装换为箭头函数，减少代码行数

解决禁止返回手势navigationOptions: {gesturesEnabled: false}

配置跳转动画，android类似iOS

找到根据不同页面配置不同跳转动画的方法了，这样使用modal时就不需要建立多个StackNavigator，直接改变动画就好了。只能在创建StackNavigator时根据跳转的routeName来区分

reset动画无解

### -17.55 
iOS选择文件时过滤掉非Office、pdf、txt的文件，把它们都直接删掉

在公众号文章列表中多选获取文章，保存到数组中。测试多次在列表中按顺序依次获取15篇文章，没有遇到需要验证码或出错的情况，说明详情页是不存在反爬机制的，就可以随意获取

多选列表支持设置选择最大值，当选择以及全选时候会判断是否超过最大值，超过就会提示，用在选择公众号文章的列表中，暂定最多选9篇


------

## 4.3 
### -11.28 
使用RNFB完成文件下载功能，有进度回调，在android上还支持显示在通知栏

> 在android使用通知栏（download manager）必须下载到外部储存空间才可以

### -11.47 
实现下载同名文件时不覆盖原文件，新文件的后缀+1

### -14.12 
文件下载页完成，下载时候显示进度条，下载完成显示打开按钮，可打开文件

### -14.35 
讨论和整理公众号、文件的api

### -15.17 
完成文件列表的多选操作，放在了右边，点击左边区域仍可预览文件


------

## 4.2 
### -10.32 
android 根据后缀检索文件功能完成，实现起来很简单（doc和docx的结果不相同），但是需要先请求外部存储权限

### -14.13 
修改本地文件区页面，兼容android，android选择文件时不需要选择类型，直接把所有的word、ppt、excel、pdf全部搜索列出来，和iOS的体验一样，点击后根据平台和类型的不同执行操作

android不能显示图片，无法加载，TBS显示一些txt有一定概率崩溃，也不显示txt

### -14.20 
iOS完成将不支持的文件类型通过其他APP打开的功能。RNFB自带的ios.previewDocument()支持该功能

浏览本地文件功能完成

### -15.18 
把请求相册的方法和结果处理逻辑合并在一个方法，从保存图片方法中分离出来，android访问外部文件之前也请求该权限

### -16.18 
找图标及颜色，在发布页中添加文件标签

### -18.34 
整理活动、推送、文件、公众号和喜马拉雅的字段、接口、流程图

