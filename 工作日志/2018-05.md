------

## 5.22 
### -13.0 
研究富文本添加链接与触摸链接的回调

### -16.43 
修复富文本编辑器的两个bug

1. 有内容时弹出键盘会升高很多
2. 有内容时在第一行写文字，光标会在最后一行和第一行来回跳动

两个bug都是由键盘弹起时，KeyboardSpacer自动调整页面高度造成的，解决的方法就是把工具栏放在编辑器的上方，当键盘弹起时再显示，webView的高度永远为屏幕高度，内部高度已经计算好不能再调整，所以不能在下方放工具栏了

### -17.13 
适配android，android加载富文本较慢，加载时loading

android onMessage不触发，无法知道已经加载完成，在WebView注入JS

```
if (window.postMessage.length !== 1) {
  window.postMessage = function(msg) {
  setTimeout(function () {
    window.postMessage(msg);
  }, 500);
}
}
```

### -18.36 
优化富文本编辑器插入链接逻辑，不使用Modal，使用alert。弹出alert后使光标聚焦到其他输入框后，插入链接无法获取到富文本的光标位置，还需研究

优化alert的输入框，多个输入框的间距减少

TODO

只有在编辑富文本时才显示工具栏


------

## 5.21 
### -13.3 
集成android文件选择器完成，使用https://github.com/DroidNinja/Android-FilePicker，放弃https://github.com/imLibo/FilePicker两个功能和页面几乎一样，但是第一个不含搜索，决定使用第二个

添加视频、音频、压缩包文件支持，不能选择所有类型

添加回调

修改主题样式完成

> 报错`No resource found that matches the given name: attr 'android:keyboardNavigat`：修改app/build.gradle compileSdkVersion 26， buildToolsVersion "26.0.1"，compile 'com.android.support:appcompat-v7:26.0.1'

### -15.33 
新的android文件选择器加入到话题编辑中

以前的选择方法废弃`  /* @deprecated */`，在选择文件时如果是android，弹出新的文件选择器，如果是iOS，__DEV__开发模式下打开本地文件列表，生产环境下打开教程

之前同时集成两个选择器进行比较，运行正常，去掉一个后build失败，需要继续升级sdk版本：compileSdkVersion 27、buildToolsVersion '27.0.3'、compile 'com.android.support:appcompat-v7:27.1.1'，添加compile 'com.android.support:design:27.1.1'

compileSdkVersion 26开始，某些不再被允许的权限与与需要动态申请的权限都不允许声明了，去掉这些权限，包括修改和获取网络状态、修改系统设置、写入联系人、写入外部文件的权限、震动、定位

### -15.43 
修复android保存图片的错误，应该直接使用DCIM目录，后面不能加Camera，华为有Camera，用来保存拍摄的图片，魅族没有，直接保存在DCIM中

打包

### -16.49 
富文本编辑，修改文字大小改为修改heading，再次点击可以取消。以前是直接修改fontSize：`document.execCommand('fontSize', false, fontSize);`，现在通过修改heading来解决`document.execCommand('formatBlock', false, '<' + heading + '>');`

加大line-height为30，h1为35



### -17.49 
创建富文本详情页，代替跳转到WebView页，在详情中统一加载数据、配置右按钮的编辑、删除点击事件

编辑文章完成，返回详情页中会更新

nav bar支持onPop，用于自定义pop按钮点击的方法，不用再重新创建一个返回按钮了

富文本编辑页点击返回按钮，如果有文字会提示是否确定返回


### -18.44 
删除文章后同步更新首页、文章管理、文章列表的数据。文章管理和文章列表使用同一个数据，首页中的数据要从board的reducer中删除

#### TODO
bug：富文本有内容时弹出键盘会升高很多，有内容时在第一行写文字，光标会在最后一行和第一行来回跳动


------

## 5.18 
### -11.15 
修复bug：活动报名时如果没有报名信息就不需要跳到下一页，是上次修改报名信息结构之后出现的新问题

活动列表显示审核中的状态

管理活动列表去掉状态的显示，本来就支持hiddenStatus参数，设置为true就好了

修复：选择票种时会默认选中最后一项可选择的票种，应该选择第一项，使用为使用了forEach一直循环，改为for循环+break，遇到可选择的就跳出循环


### -11.54 
iOS支持所有文件的上传，iOS做起来比较简单，只是把限制取消掉而已，图片点击查看大图

查看其它android APP的文件显示方法

从github找文件选择的组件，自己实现搜索、检索、排序，并且高效率比较难

### -17.12 
android 分别比较[https://github.com/DroidNinja/Android-FilePicker](https://github.com/DroidNinja/Android-FilePicker)和[https://github.com/imLibo/FilePicker](https://github.com/imLibo/FilePicker)两个文件选择器

FilePicker 51star，中国人做，比较流畅
Android-FilePicker 1500star，效果也不错

都能区分图片、视频、像QQ一样列出各种类型的文档，也能分类型展示文档，可以选择最大数量、排序方式、更换样式和主题

> 最开始两个依赖在Android Studio死活下载不下来，以为需要翻墙，又下载了3个VPN，还买了一个VPN，都不管用，报错是Failed to resolve，然后终端运行，报错Failed to connect to 127.0.0.1 port 8888 :conection refused，检查端口也没占用。重启解决

------

## 5.17 
### -10.23 
对于昨天android每个库都需要改rn版本的问题，社区有了新的解决办法

android/build.gradle

```
allprojects {
    repositories {
        ...
        configurations.all {
            resolutionStrategy {
                force 'com.facebook.react:react-native:0.47.2' // <-- add this
            }
        }
        ...
    }
}
```

android/app/build.gradle

```
dependencies {
    compile ("com.facebook.react:react-native:0.47.2"){
        force = true;
    }
   ...
}
```

### -10.49 
抽取创建article方法createArticle，创建其他article都是调用它只是方法不同

### -12.7 
修改富文本编辑页，支持输入标题、修改导航栏标题

修改编辑器的高度算法，传入WebView的offset  y，可以正确算出编辑器的位置了，在设置上边距和标题输入框后能正确的计算换行位置

### -13.47 
创建origin文章完成

在添加图片时把图片转换成base64放在了src里，同时放一个图片的本地uri存为src-uri，在点击完成时，使用cheerio遍历所有img，把src-uri取出来上传图片，然后再获取到上传后的url，把src替换为url，再把src-uri删掉

需要注意cheerio的each不支持async，需要遍历并保存到一个数组中，调用for of来async上传

### -14.2 
article列表支持origin，因为没有图片，效果很丑，可点进详情查看

### -18.26 
查看文章详情时，如果是origin文章，就改变字体，在点击push时在html的最后加一个style标签

修复WebView加载html字符串时，不显示默认标题的bug


------

## 5.16 
### -13.28 
在android上测试新修改的富文本编辑，一直运行不起来

android上报错404，在Dev Settings关闭了Use JS Deltas，修改后报新的错`View has no propType for NativeProp RCTView.borderTopRadius of native type number`，查了issue没有结果，Google后在stackoverflow遇到了昨天刚开始发生的同样的错误`
exactly same issue bro. I have been facing this from yesterday. Also everything was fine, I did not make any change... Still having that issue. any solutions yet?  41 mins ago`

上QQ看到RN群里也有人在问这个问题，晴明大神指点了一个issue，[https://github.com/facebook/react-native/issues/19259](https://github.com/facebook/react-native/issues/19259)，23小时前创建的，发生在昨天

1. 卸载APP
2. 修改app/build.gradle，dependencies里的react-native，改为`compile "com.facebook.react:react-native:0.45.1" { force = true } // From node_modules`，原理是在android上锁定RN版本，否则会下到最新的版本，导致各种兼容问题
3. 重新运行，OK

在0.49及以上的RN版本中会有新的报错信息`React Native version mismatch. JavaScript: 0.50.3 Native version: 0.55.3`，更好查一些，其实最开始的404在issue一查就能查出来。在QQ群里依然不停的有人在问这个问题，不停的有人在提醒翻聊天记录


### -15.29 
运行后，有崩溃现象，还是因为这个原因

需要修改react-native-svg等第三方里build.gradle

全局查找 `compile "com.facebook.react:react-native:+"`

改为`compile ("com.facebook.react:react-native:0.45.1") { force = true } // From node_modules`

> 根RN因为参与者说，Google最近几个月要搞大动作，也是导致这个问题的原因

### -18.26 
android测试富文本的新功能，发现onMessage、添加图片都不管用，因为android release模式需要将静态文件复制android_asset中，所以进行了判断，导致直接去访问android_asset了，应该判断PlatformIOS || __DEV__，是开发模式或者iOS才会直接访问editor.html，否则就访问build时复制到android_asset的editor.html，

修改htmlCopy.gradle，同时把editor.html中的jquery放在到单独的js文件也一起复制，因为3000多行的jquery太影响阅读和查询，经测试可行，打包后运行正常

添加图片没有问题，初始化时光标也定位到了最后，但是没有弹出键盘，暂时没有办法，没有在android中找到类似keyboardDisplayRequiresUserAction的参数，而且因为是jar文件，也无法进行修改

修改iOS一些源文件，打包


------

## 5.15 
### -10.41 
富文本通过base64添加图片成功

修改富文本功能的所有结构，原作者写的太差，太多无意义的type和handler，全部使用方法调用来实现，而不是switch/case

### -17.38 
查找富文本键盘弹起的办法，contenteditable的div，focus不管用，找到的所有Section和Range修改光标都不管用

解决：

1. 经过测试，设置了focus在点击空白后也会弹出键盘，没设置时只在点击文字时才会弹出，所以focus还是有用的，只是通过RN的WebView无法弹出键盘
2. 查到了iOS原生WebView的一个属性`keyboardDisplayRequiresUserAction = NO`，RN并没有支持，修改源码后，不管是设置Range还是focus都生效了，在init时需要延迟执行，等文字加载出来再执行。android无法测试，网络问题无法Build
3. 搞了一个半小时，想继承RCTWebViewManager来支持keyboardDisplayRequiresUserAction参数的修改，但是每次继承它都会link错误，继承RCTViewManager没问题，解决不了
4. 上一步的错是个失误，RCTWebViewManager.m的Target Membership误点取消了打钩，导致这个文件不能被项目查询到...修改后重新继承它，依然没办法通过继承的方式扩展WebView，继承完成后RN的WebView代码也一大堆，不可能复制过来重新修改
5. 只能改源码RCTWebView.m，设置keyboardDisplayRequiresUserAction为NO

可以做到在初始化时弹出键盘并且光标定位到最后，但是插入图片完成后无法弹出键盘

> 学会了iOS设置和访问私有变量：setValue、valueForKey

### -18.14 
优化富文本编器换行，当输入的文字在最后一行，换行后自动向上滚，让新输入的文字可见，暂时不能设置上下padding，会导致计算错误产生误差


------

## 5.14 
### -11.48 
研究iOS的模拟定位，只需要使用Xcode新建一个空白项目，运行到手机上，点Xcode中控制台上的定位选择地址就可以模拟定位，也可以使用自己的gpx文件来模拟故宫，然后整个手机的app都会定位到这里

高德地图故宫内坐标：

```
<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.0">
    <name>Example gpx</name>
    <wpt lat="39.9174" lon="116.391218">
        <name>LAGORETICO</name>
    </wpt>
</gpx>

```

高德地图里当自己处于景区内，放大地图可以看到导览、导游的图标，可以查看导览图

### -15.13 
浏览高德地图文档，有小程序版，没找到支持景区的地图。在论坛中看到了类似的问题，回复说需要和商务联系。找到了在iOS中打开高德的方法，可以进行导航、线路规划，但是依然没有景区线路的规划

### -18.31 
想在富文本编辑时直接显示本地的图片，最后再上传，不可以，WebView只能显示打包起来的图片，不能显示相册中的图片，还是只能上传再显示

富文本编辑器支持选择多张图片，最多9张，依次上传并且显示出来

fs实现将本地图片转换为base64的方法，将base64放在富文本编辑器中显示出来

#### TODO

1. 每次添加完图片都把光标移动到最后，并且重新弹出键盘
2. 每次刚进入编辑都把光标移动到最后并且弹出键盘


------

## 5.11 
### -11.48 
优化音频播放类，简化播放器的方法，只保留公开2个方法：播放新音频/继续播放、播放暂停、获取正在播放的音频url、是否正在播放；隐藏播放器释放的方法。点击一个音频，如果它正在播放，就暂停，否则就开始播放，播放器会判断是不是新音频，如果是新的，就新建播放器，不是新的就继续播放

在actions中去掉正在播放的参数，留下当前播放url的参数，为了方便页面显示，不用在每个页面创建state

### -16.0 
上传、播放音视频完成，主要是优化音频的播放

文件的音频图标加入播放和暂停的状态，音频在当页播放，不需下载

在push和pop的总方法中都让音频暂停，每次页面跳转都会暂停播放音频

优化语音回答页的逻辑，简化了十几行代码

> 原以为要支持视频和音频就要修改下载逻辑，下载文件后返回再打开，结果不需要，视频和音频不需要下载就能播放，简单太多，只需要直接播放音频，执行顺序理清，回调正确就可以了


### -17.59 
开会、整理任务周报


------

## 5.10 
### -11.48 
创建打卡评论action、修改话题评论action。

打卡显示评论和下箭头，点赞和评论按钮的样式和话题列表统一，点击下箭头弹出删除，如果不可以删除就不显示箭头

修改评论按钮的样式

打卡列表列出前3项，图片不可点击

### -15.23 
图片使用FastImage，防止在FlatList只闪烁

创建打卡详情列表，点赞和外面列表实时更新（使用自身state，外面列表使用redux），删除后返回，支持上拉下拉加载数据

点击评论显示回复、复制和删除按钮

### -16.9 
创建从底部弹出的多行文本输入框，支持最大高度和最小高度

### -18.18 
可以创建评论、回复评论，新建随键盘弹出的多行文本输入框，在模拟器上显示和隐藏会有闪烁现象，因为没有键盘弹起，真机不会

评论、删除评论后，外面列表实时更新，里面使用state、外面使用redux

点击评论的用户可进入用户主页

> 评论列表因为每一行的高度太少，导致分页经常重复加载，优化分页逻辑，在设置loading的state执行完成后再进行网络请求以及取消loading，需要在刷新和加载更多时都加入该逻辑

打卡评论功能完成，打包新版本出错，适配了iPad后需要其他尺寸的icon：76、152、167，暂时改回不支持iPad的版本

#### TODO
1. 通知里的打卡评论
2. 修改话题评论


------

## 5.9 
### -11.54 
优化地图页

1. 去掉地图的下载按钮，主动调用injectJavaScript注入一段JS代码，`document.getElementsByClassName('downloadContainer')[0].parentNode.removeChild(btn);`，要删除的是downloadContainer，而不是downloadBtnCover
2. 通过onNavigationStateChange获取到webView路由状态，如果可以返回，说明不是第一页，显示正常的状态栏，如果是第一也，那说明是地图页面，变为透明的状态栏，返回按钮为黑色圆形
3. 是第一页时直接pop出去，不是第一页就调用webView的back来返回，返回到网页的上一页

### -14.26 
地图适配安卓，打包iOS，APP体积直接从21.6M下降到10.7M

> android的WebView需要允许运行JS javaScriptEnabled
> 打包iOS时，RN的iOS部分遇到6处输出的类型错误，很奇怪，以前没遇到过，直接点fix就行

### -16.47 
调研地图覆盖物，称为瓦片地图，[天地图、百度、高德、腾讯、Leaflet、openlayers地图图片叠加层切片生成工具使用指南
](https://blog.csdn.net/bq_cui/article/details/47372005)，想做出来还需要大量的时间去学习研究

### -18.25 
支持、适配iPad，主要改动如下：

1. 圈子首页封面图高度自适应，修改了下拉放大的逻辑
2. 打卡、问答、活动、文件库的圈子封面图高度自适应
3. 在resValue.js中添加常量：Pad，用于判断是否是Pad设备
4. 点击加号的发布页面，如果是Pad，圆形的宽度固定为100，否则太大了
5. 首页的中间三个按钮宽度自适应，不使用固定宽度，同时适配了iPhone5s等小屏


------

## 5.8 
### -11.47 
腾讯地图有用于定位的LBS SDK，还有用于地图显示的SDK，先集成LBS

iOS集成LBS成功，只用于定位，搜索poi直接通过腾讯地图的api来获取，不用桥接了

### -17.21 
android腾讯定位SDK集成成功

回调一直不执行，是因为没有引入so文件，这是用到的第一个需要引入so的SDK，都放在src/main/jniLibs中

requestSingleFreshLocation是用来只获取一次定位的方法，不能配置返回结果等级，但是够用，可以返回地址信息，requestLocationUpdates用于实时位置更新

### -18.5 
iOS申请定位权限，以前申请权限百度给做好了，腾讯没有做。

> 遇到一点问题，请求权限的CLLocationManager不能在询问时再初始化，应该在询问之前就初始化了，否则就会一直弹出询问权限的alert

### -18.32 
地图组件显示为腾讯地图的Web组件，使用WebView，可显示周边、路径、定位，把导航栏设置为透明，让地图显示区域更大

#### TODO
1. 修改导航栏返回按钮，更清晰
2. 让返回按钮可以控制地图网页的返回
3. 禁止地图页的边缘返回手势


------

## 5.7 
### -15.6 
#### android集成react-native-maps

1. 修改了build.gradle、settings.gradle，需要使用gradle4.4的支持，使用android studio下载不下来，在迅雷下载gradle-4.4-all.zip，然后放在`/Users/huowenxuan/.gradle/wrapper/dists/gradle-4.4-all/9br9xq1tocpiv8o6njlyu5op1`中，重新build，就会自动解压

    > build.gradle中添加compile project(':react-native-maps')即可，不需要添加google services

2. 在settings.gradle中添加了maps的后，提示需要将gradle升级到3.1.1，因为里面使用了compileOnly，需要高版本支持，下载google的maven/builder又卡住，使用迅雷下载完成后，放在`/Users/huowenxuan/.gradle/caches/modules-2/files-2.1/com.android.tools.build/builder/3.1.1/896e9214fc6b62c5979919c8ddc9e29cfea3ec9c`中
3. 在jcenter()下再添加一个google()。经历过无数次失败与重试之后build成功（在新的gradle版本中，dependencies的compile用implementation代替，但是可以忽略，build过程中会自动转换）
4. 运行后闪退，需要在app/build.gradle中dependencies之前，添加如下代码

    ```
configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details ->
        if (details.getRequested().getGroup() == 'com.google.android.gms') {
            details.useVersion('9.8.0')
        }
    }
}
    ```

4. 运行成功后提示`您的设备不支持Google Play服务，因此无法运行鹿小圈`，试过几种办法后都不行，都是要安装Google Play，完蛋。



继续调研，携程、蝉游记等旅行APP都使用google地图，有人通过工具查看APP页面结构发现是使用了webView加载中国的谷歌地图[https://www.google.cn/maps/](https://www.google.cn/maps/@43.6105356,104.7513461,4z)、[https://www.google.cn/maps](https://www.google.cn/maps)，不能使用谷歌地图android版，那功能全面的react-native-maps也不能用了

github上搜索react native map，第二名的mapbox是制作自己的地图，也不能用，高德、百度、腾讯地图都没有能用的react-native版本，如果想做道路规划等，只能有两种方法：1) 自己桥接高德、百度、腾讯地图，缺点是工作量太大，维护太麻烦。2) 使用WebView加载网页版地图，缺点是和RN交互不方便、加载需要网络的支持










### -15.44 
优化话题评论的点击，如果有网址，就弹出网址和回复按钮，如果没有网址，点击后直接去回复

### -16.39 
修复android多行输入框无法换行的bug。主要通过两个参数来实现selection、onSelectionChange，selection为状态，和value类似，onSelectionChange为回调。同时处理两个输入框的bug：1）onSubmitEditing会执行两次，并且两次的参数完全一样，通过setTimeout实现；2）当输入当换行插入到最后一个字符后面，onSelectionChange的end并没有+1，需要自行判断字符串的长度来设置selection

```
    if (this.props.multiline && Android) {
      androidMultilineParams = {
        multiline: true,
        blurOnSubmit: false,
        onSelectionChange: ({nativeEvent: e}) => this.setState({selectionAndroid: e.selection}),
        selection: this.state.selectionAndroid,
        onSubmitEditing: () => {
          // onSubmitEditing在android才会执行
          if (!this.timeout) {
            const {end} = this.state.selectionAndroid
            const {value} = this.state
            let newValue = value.slice(0, end) + '\n' + value.slice(end)
            this.setState({value: newValue}, () => {
              // 当换行插入到最后一个字符后面，onSelectionChange的end并没有+1，需要判断
              if (newValue.length - 1 >= end + 1) {
                this.setState({selectionAndroid: {start: end + 1, end: end + 1}})
              }
            })
          }

          this.timeout = setTimeout(() => {
            clearTimeout(this.timeout)
            this.timeout = null
          }, 500)
        }
      }
    }
```

### -16.57 
优化push操作，避免多次点击多次push，不使用setTimeout，一是代码丑陋，二是如果真的用代码控制连续跳转两次，就会跳转失败，使用如下逻辑：当最后一个页面和即将push的路由的名字和参数完全一样，就不push

```
function push(routeName, params) {
  // 当路由栈的最后一个路由和即将push的路由的名字和参数完全一样，就不push
  if (_.has(navigator, 'state.nav.routes')) {
    let routes = navigator.state.nav.routes
    let last = routes[routes.length - 1]
    if (last.routeName !== routeName || JSON.stringify(last.params) !== JSON.stringify(params)) {
      navigator.dispatch(NavigationActions.push({
        routeName,
        params
      }))
    }
  }
}
```

还可以做`如果即将push的路由的名字和参数，和路由栈的非最后一个路由相同，就pop到对应的路由`，觉得没有必要，暂时不做

### -18.29 
调研腾讯地图。计划自己集成腾讯地图，可以使用地图的其他功能，并且和小程序配合，不需要做坐标转换，原本的rn-baidu-map功能太弱。先做定位功能，也许地图功能会在WebView显示

定位服务需要接SDK，web版的定位只能通过IP，精确到市级



------

## 5.4 
### -16.9 
继续集成reace-native-maps，根据官方文档的步骤，总是不成功，在pod中集成之后一直报c++错误，自己尝试手动集成

### -16.31 
修复android一系列bug：

1. 圈子首页返回按钮的响应：containerWrapper改为reduxWrapper
2. 点击话题按钮不滚动：measure方法在android上不管用，使用onLayout计算高度
3. android换行：RN的老bug，多行文本点击换行会收回键盘，现在的做法是点回车不收回键盘，在最底部多一行，还需要优化
4. 切换圈子加载失败没有重现

### -18.32 
rn-maps终于接入成功，成功显示谷歌地图，使用link的方式一直报错找不到GoogleMaps.h，通过Pod安装或者直接导入GoogleMaps.framework都找不到，最终使用笨办法解决，把rn-maps的ios中的两个文件夹链接（非拷贝）到项目中，可以正常运行，即使将来升级maps版本，因为是链接过去的，也可以运行

查找谷歌地图国际化的方法，是跟随系统语言走的，不需要自己实现


------

## 5.3 
### -10.42 
解决昨天刚出现的点击话题按钮崩溃的问题

是因为封装了ListView的父组件，在react中ref和key一样比较特别，只对辈分最大的组件生效，使用rest传参数给子组件也不行，还是指向父组件。仔细研究了react官方文档，找到了新的办法，但它是react 16.3中新出的api，以现在的react-native版本还不能使用

新的API修改了ref创建的方式，旧方式依然可以用

```
// 旧
this.view = null
<View ref={(view)  => this.view = view}/>

// 新
this.view = React.createRef()
<View ref={this.view}/>
```

新增Forwarding refs：可在父组件中得到子组件中dom的节点

```
// 子组件
const Child = React.forwardRef((props, ref) => <Input ref={ref}/>)

// 父组件
class Father extends React.Component{
  constructor(props){
    super(props);
    this.child=React.createRef();
  }
  render(){
    return <Child ref={this.child}/>
  }
}
```

官方文档中HOC（高阶组件）写法：

```
function logProps(Component) {
  class LogProps extends React.Component {
    componentDidUpdate(prevProps) {
      console.log('old props:', prevProps);
      console.log('new props:', this.props);
    }

    render() {
      const {forwardedRef, ...rest} = this.props;

      // Assign the custom prop "forwardedRef" as a ref
      return <Component ref={forwardedRef} {...rest} />;
    }
  }

  // Note the second param "ref" provided by React.forwardRef.
  // We can pass it along to LogProps as a regular prop, e.g. "forwardedRef"
  // And it can then be attached to the Component.
  return React.forwardRef((props, ref) => {
    return <LogProps {...props} forwardedRef={ref} />;
  });
}
```







### -12.14 
尝试升级react到16.3.4，不可以，react native不兼容，react native也无法升级到0.46

### -12.32 
首页的活动支持分页滚动功能，手指释放后自动滚动到边缘

> ScrollView设置pageEnable后滚动的区域必须是容器宽度的整数倍，无法实现小于宽度的滚动分页，在[Stack Overflow](https://stackoverflow.com/questions/45618853/react-native-scrollview-with-pagination-showing-part-of-the-next-page)找到了一个组件[react-native-snap-carousel](https://github.com/archriss/react-native-snap-carousel/)支持这样的效果

TODO

1. 关闭放大缩小的效果
2. 测试android

### -15.4 
修复android上一个问题，对Array.entries()进行for of循环会崩溃，报迭代器错误，在iOS没问题

继续研究Carousel，因为子项不是默认的居中排列，是向左排列，使用了负的marginLeft来实现，这样的话在android上超出的就不显示了，而且对android支持的也不好：没有间距、不会缩小，所以在android不使用这个组件，只在iOS使用

找到了调整不显示项目的透明度和大小的两个参数 inactiveSlideScale、inactiveSlideOpacity，先不使用，现在效果可以

### -18.22 
运行react-native-maps的demo，在中国可以正常访问，谷歌地图网站也可以使用。开始集成

在iOS上集成rn-maps，文档提示`!! DO NOT USE !! react-native link`，修改podfile文件集成



------

## 5.2 
### -9.50 
合并主页标题栏动态换标题文字的功能，去掉动画效果

### -11.52 
解决更换标题后卡顿的问题，在onScroll中setState会重新渲染scrollView造成卡顿，解决方法是再封装一个圈子首页的ListView，当标题改变时不重新渲染

```
class BoardHomeList extends Component {
  constructor(props) {
    super(props)
  }

  // 优化在onScroll时setState造成的卡顿
  shouldComponentUpdate(nextProps, nextState) {
    return nextProps.navTitle === this.props.navTitle
  }

  render() {
    return <TopicList {...this.props}/>
  }
}
```

分享朋友圈还是使用网页

测试分享、打包

### -13.10 
手机号登录、注册，让区号按钮不可点击

### -16.30 
修改活动的时间显示规则

#### 开始时间
* 结束时间和开始时间是同一天，而且是今天，显示time，不显示date
* 结束时间和开始时间不是同一天显示date（如果和现在同一年，不显示年份）
#### 结束时间
* 结束时间和开始时间是同一天，而且是今天，显示time，不显示date
* 结束时间和开始时间是同一天，但不是今天，不显示结束时间
* 结束时间和开始时间不是同一天显示date（如果和现在同一年，不显示年份）

### -18.24 
优化iOS的打开外部链接功能，在iOS上不需要跳转到Safair了，可以在本地打开一个Safari窗口显示网页。是iOS9新出的功能，导入SafariServices.framework，新建SFSafariViewController，直接present

测试，打包新版本


### -18.52 
修复圈子首页标题显示错误，以前使用了假数据，考虑到圈子信息没有加载出来的情况，让第一个锚点的top固定为200，title为空，在滚动时如果top为200并且state中有圈子信息才在导航栏显示标题



