------

## 6.20 
### -18.33 
学习matplolib，在网上找到计算公式，使用numpy和matplolib模拟太阳，月球，地球的相对运动，先把地球公转轨道当成圆形，将来可以进行优化，对计算方法进行封装，将来可以扩展到所有行星中

------

## 6.19 
### -10.36 
修复android分享无响应的bug，之前在修改代码时把UShareManager改成了ShareManager，为了不让框架在功能文件上体现出来，将来换了sdk不用修改文件名

### -14.9 
瓦片地图还是比较难的，不适合在现在的项目中研究，所以准备新建项目来集成，同时做技术和工具软件的准备，使用些好用的最新的技术框架

1. TS还是JS

    静态类型检查是必须的，要实现静态类型检查就只有ts和flow，个人非常喜欢ts，查看了大量ts和flow对比的文章，基本都是说flow的好处是使用原生js、es6、es7、es8，拥抱js，坏处是检查出类型错误不会提示应该是什么类型；ts的好处是全面支持js、es6、es7，熟悉之后生产力强大，有了类型的检查，开发和维护都相当快，坏处是对代码入侵大，如果想改回js不是那么容易，学习和维护成本较高，但是比起es5的时代已经很好了，ts和es6非常像。暂时选ts，如果有大坑还来得及转为flow

2. redux/mobx

    直接大型redux，感觉mobx特别不容易维护，虽然写起来很简单

3. redux应用框架

    redux-thunk、redux-promise、redux-actions是现在项目使用的方案，虽然使用起来真正可以满足所有复杂的需求，但是写法不统一，并不是最好的解决方案
redux-saga很好可以用
dvajs淘宝团队出的基于redux-saga的轻量级框架，使用简单，去年就想用，但是学习成本较高，并没有太多时间和经验去使用好，saga的核心是Generator，使用* yield，在全面学习过Generator后，可以很快上手，在不考虑学习成本的前提下，dva确实是现在社区中最佳实践

4. 导航

    react-navigation




同时了解了koa2、rn图片渐现动画的实现方案

### -15.23 
项目新建成功，同时使用ts开发，rn本身支持ts，只是需要做一些改动，参考https://facebook.github.io/react-native/blog/2018/05/07/using-typescript-with-react-native.html

跟着文档中的命令，并没有生成tsconfig.json，参考https://github.com/Microsoft/TypeScript-React-Native-Starter来手动配置

```
{
  "compilerOptions": {
    "target": "es5",                          /* Specify ECMAScript target version: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017','ES2018' or 'ESNEXT'. */
    "module": "commonjs",                     /* Specify module code generation: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', or 'ESNext'. */
    "jsx": "react",                           /* Specify JSX code generation: 'preserve', 'react-native', or 'react'. */
    "noEmit": true,                           /* Do not emit outputs. */
    "strict": true,                           /* Enable all strict type-checking options. */
    "moduleResolution": "node",               /* Specify module resolution strategy: 'node' (Node.js) or 'classic' (TypeScript pre-1.6). */
    "baseUrl": "./",                          /* Base directory to resolve non-absolute module names. */
    "allowSyntheticDefaultImports": true,     /* Allow default imports from modules with no default export. This does not affect code emit, just typechecking. */
    "esModuleInterop": true                   /* Enables emit interoperability between CommonJS and ES Modules via creation of namespace objects for all imports. Implies 'allowSyntheticDefaultImports'. */
  },
  "exclude": [
    "node_modules"
  ]
}
```

重启RN服务，运行成功，编译、reload速度一样快

需要注意

1. 组件文件后缀为tsx，功能文件后缀为ts
2. 入口index.js不能改为index.ts










### -15.44 
开始集成地图

高德地图iOS文档：[绘制面](https://lbs.amap.com/api/ios-sdk/guide/draw-on-map/draw-plane)

> 图片覆盖物：图片覆盖物类为 MAGroundOverlay，可完成将一张图片以合适的大小贴在地图指定的位置上的功能。
> 瓦片图层：通过瓦片图层可对基础底层地图添加额外的特性，如：某个商场的室内信息、某个景区的详情等等。自定义图层类是MATileOverlay，它定义了能添加到基础底层地图的图片集合。添加瓦片图层的前提是使用球面墨卡托投影生成了相应的瓦片，并按照生成的格式部署在您的服务器上。

### -18.38 
按照文档的描述添加了覆盖物，但是不显示，查过google、github都没有答案，图片使用jpg、png，大的小的都试过，最终查到的问题所在，应该把setDelegate写在addOverlay之前。iOS的地图成功显示了覆盖物，使用本地的图片，可以设置覆盖物在缩放到什么等级再显示，默认永远显示

------

## 6.8 
### -13.50 
修改话题评论，从下弹出的输入框，需要修改五个地方的评论，包括话题列表、详情的评论、评论页、消息页

在消息页面区分回复话题还是签到，并且在回复后加上话题或者签到字样

和话题评论一样，简化签到评论的调用action方法

> 因为传的参数比较麻烦，直接把topuc和replyData传给action统一处理

### -15.50 
修复打卡详情页面，如果评论为空，会显示咖啡图标的错误

来给ListFooter传的isNull固定为false，那么就一定不会显示咖啡图标，但是当列表为空或者分页不够一页时，onEndReached不能正确响应，导致noMore本改为true，却一直是false，这个问题很麻烦，困扰了很久，一直没有好的解决办法，造成这个问题的根本原因是react永远只能异步操作state，onEndReached在不足一屏时总是会优先于setState导致数据不能及时的更新。最终的解决办法是给ListFooter增加隐藏咖啡图标的参数

### -17.52 
其他错误处理，兼容sign_rank、settings.apps不存在的情况

修复react-navigation的bug，是新版navigation带来的，从页面A 快速pop到页面B，再reset到页面C后，会reset到页面A，应该是在pop没完成就reset，路由的状态和路由栈的层次获取不对导致的

------

## 6.7 
### -12.0 
如果是可多次打卡，在圈子首页也可进行多次打卡。每日打卡的可点击范围增大，点击卡片上方区域也可进入

个人中心的消息页修改完成

### -14.51 
修复打卡页、我的打卡显示打卡天数的错误，直接使用圈子信息中的数据，而不是从ranking中获取，昨天修改了getRank的的参数，而没有全局查找导致的错误

### -15.10 
使用eslint，使用aribnb的规则

1. 按照教程全局安装eslint、eslint-config-airbnb
2. 项目中添加文件.eslintrc，添加

    ```
{
  "extends": "eslint-config-airbnb"
}    
    ```

3. 运行eslint index.js，报错，找解决方法
4. 不使用全局的eslint，使用项目本地的eslint，npm install --save-dev eslint、eslint-config-airbnb、eslint-plugin-jsx-a11y、eslint-plugin-react、react-test-reanderer、eslint-plugin-import
5. 执行`./node_modules/.bin/eslint index.js `
6. 配置package.json更方便的使用eslint，npm run lint index.js

    ```
"scripts": {
    ...,
    "lint": "./node_modules/.bin/eslint"
}
    ```

### -18.14 
查看`http://www.aliued.com/?p=4095`学习jest测试

------

## 6.6 
### -10.2 
创建完成圈子后的页面可直接跳转到应用管理页

### -11.56 
查找修改思源黑体下间距的办法，没找到...

研究android自带字体，android支持三种字体sans serif monospace，sans是默认的，后两种对中文没有支持。对于fontWeight属性，虽然支持100、200到900，但android的系统字体只支持normal和bold

重新导入思源黑体，仔细比对思源黑体和苹方，作为非设计师除了边距实在看不出来和苹方有什么区别，而且加入字体后体积会大很多，所以在iOS上不使用字体，只在android上使用。在自定义StyleSheet中判断是文字，而且是粗体就设置为SourceHanSansSC-Medium字体，并删除fontWeight属性，SourceHanSansSC-Bold太粗。（经过多次测试，SourceHanSansSC-Normal也不支持设置fontWeight为400或500，不能用一个字体文件通吃，所以还是要乖乖打包粗体字体，但是现在可以不打包普通大小的字体）



### -15.25 
完成打卡排行榜，修改为最新的样式，自定义DefaultTabBar，原作者写的太不易于扩展了

### -18.21 
1. 活动标题暂时改为一行
2. 打卡列表显示已坚持天数
3. 完成多次打卡功能
4. 所有的空列表显示咖啡杯，在适合的页面显示文字为“当前没有...”或者“这里空空如也”

------

## 6.5 
### -13.45 
修复旧版本bug，打包上架新版本

帮助糖水解决bug，`Failed resolution of: Landroid/support/v4/animation/AnimatorCompatHelper;`更新buildToolsVersion到26即可

### -15.0 
查看简书的富文本编辑器源码，查看Tower开源富文本编辑器simditor

查看JTest测试

集成iOS高德定位SDK

### -15.33 
修复android输入闪退的bug，RN0.55中TextInput的onChange没有contentSize字段了，打包上架，应用宝、VIVO、华为审核中不能再上架，稍后再上

### -17.10 
iOS和android集成高德定位完成，获取到定位信息，封装MapManager用来统一管理定位相关的方法，删除腾讯LBS libs

### -18.22 
使用新版RN的TextInput新功能

已经修复了之前不能换行的bug，也支持了minHeight，以前自己写的兼容方法可以删掉了

页面跳转时autoFocus也不会卡顿，去掉以前的延迟facus操作



------

## 6.4 
### -10.7 
消息评论显示白屏的bug：因为打卡时直接取topic信息，后台也没有返回sign信息

### -10.30 
下载蚂蜂窝apk，解压，在assets/fonts中找到了字体，拼写是pingfang，网上说无法得到苹方的商用授权

解压简书没找到字体，但是找到了富文本编辑器，和我一样使用ZSSRichTextEditor，可以参考

### -14.16 
上周在我的电脑上给加固的apk签名不了，360的工具签名失败，腾讯的只有windows版，查找简单在mac运行exe的方法，各种虚拟机不考虑，wine不会，winebottler运行不起来exe，crossover成功，可以加固并签名，但是收费

### -17.53 
在看简书富文本编辑器源码时看到了字体，SourceHanSansCN/SourceHanSansSC，思源黑体，是adobe开源的字体，在github上下载到了这个字族的五个字体，开始安装

1. iOS：1）将字体拖入到工程中。2）编辑Info.plist，添加key：Fonts provided by application，把五种字体的文件名+后缀一个个添加进去
2. Android：导入到assets中，完成

在RN中直接设置fontFamily，fontWeight不管用了，如果是粗体直接指定粗体的字体，在全局自定义StyleSheet：CustomStyleSheet中判断如果是文字就设置字体

但是效果并不好，android文字的下间距会变的的很大，iOS正常，在知乎上搜索也都是这样的问题，`"不好排版，基线下方空间太多是一个很不成熟的地方。它暂时不太好用，不知道会不会修改这个Bug。"`

下载更新的superOTC版本也不行，还需要找解决办法或者其他的字体

------

## 6.1 
### -14.42 
全面测试

1. 优化打卡详情的评论与删除评论
2. 修复打卡不能删除自己评论的错误，没有取user_id._id
3. 点击圈子首页的话题按钮进入话题页
4. 文章详情适配新版RN，默认设置scalesPageToFit为true，在手机上看起来太大了，需要设置为false，文件查看依然要设置false
5. NetInfo.fetch即将废弃，使用NetInfo.getConnectionInfo().then(({type, effectiveType})=>{})，在iOS和Android返回的大小写相同
7. 优化打卡流程，打卡后直接刷新圈子信息和动态，首页可以直接刷新数据。首页点击去打卡跳转到创建打卡页，如果打过卡就禁止点击，点击后交给父组件来响应（跳到打卡列表）
8. 在打卡列表、我的打卡、打卡详情中删除打卡，如果是删除自己的打卡，就刷新圈子信息和动态信息，首页可更新打卡状态
9. 创建打卡类型的小按钮加入圆角
10. iOS FastImage暂时去掉进度，在真机和模拟器最后一个参数有差异


### -18.0 
打包、加固、上传版本，加固和签名搞了一个半小时，自己的360加固永远签名失败，在别人电脑上一下就好了

