# 代码整洁之道

## 第1章 整洁代码

## 第2章 有意义的命名

- 名副其实：变量、函数、类的名称该告诉你它做什么事，应该怎么用，如果名称需要注释，就不算是名副其实

- 别用accountList来值指称一组账号，除非真的是List类，否则会引起错误的判断，命名为accountGroup或bunchOfAccounts，甚至accounts都会好一些

- 做有意义的区分：info和data就像a、an、the一样，是意义含混的废话

- 成员前缀：不必使用m前缀来标明成员变量，应当把类和函数做的足够小，消除对成员前缀的需要

- 类名和对象名应该是名词或者名词短语，Customer、WikiPage、Account、AddressParser。避免使用Manager、Processor、Data、Info这样的类名（意义含糊的废话）。类名不应当是动词

- 方法名应当是动词或动词短语。postPayment, deletePage, save

- 每个概念对应一个词。例如fetch和get，controller和manager，保持一致

- 别用双关语。例如在连接两个值时使用了add，把单个值放在collection中就应该使用insert或append，不应该为了保持一致使用add

## 第3章 函数

- 短小。函数的第一规则是要短小，第二条规则是**还要更短小**。函数不应该有100行那么长，20行封顶最佳

- 只做一件事，每个函数一个抽象层级。如果该函数只是做了该函数名下同一抽象层上的步骤，则函数就是只做了一件事。可以将if语句拆出来，但只是重新诠释代码，并未改变抽象层级。所以，要判断函是否不止做了一件事，可以看是否能再拆出一个函数，该函数不仅只是单纯地重新诠释其实现
    - 向下规则：自顶向下读代码，让每个函数后面都跟着位于下一抽象层级的函数

- 使用描述性的名称
    - 函数功能越小、功能越集中，越便于取一个好名字
    - 别害怕长名称，长而具有描述性的名称，比短而令人费解的名称更好，比描述性的长注释好
    - 别害怕花时间取名称，使用IDE测试不同名称，直至取到最具有描述性的名称
    - 命名方式保持一致
    
- 函数参数。最理想的参数类型是0，其次是1，再其次是2，应尽量避免3
    - 不应该用布尔值作为参数（骇人听闻🐶），函数做了两件事，应该拆成两个函数
    
- 无副作用

- 抽离try/catch代码块。try/catch丑陋不堪，搞乱了代码结构，将他们抽离成函数，与正常流程分开。错误处理就是一件事。所以处理错误的函数不应该做其他事

## 第4章 注释

- 注释不能美化糟糕的代码

- 用代码来阐述。尽量用函数名来描述，而不是注释

- 好注释
    - 法律信息
    - 提供信息的注释。例如解释了抽象方法的返回值
    - 对意图的解释（程序员的主观想法）
    - 阐释。帮助阐释参数或返回值的意义，更好的方式是尽量让他们自身就足够清除，但如果是某个库中的一部分，或是不能修改的代码，就可以使用注释来阐释
    - 警示。警告其他程序员会出现某种后果
    - TODO。 `// TODO`。应该做却没做的工作
    - 放大某种看来不合理的事物的重要性
    - 公共API的doc

- 坏注释：怀注释都是糟糕代码的支撑或接口
    - 循规式注释。每个函数、每个变量都有注释的规矩是愚蠢可笑的，让代码变得散乱
    - 日志式注释、归属与书名。记录每次修改的日志，有了源代码控制系统之后，这种记录只会让代码变得凌乱。源代码控制系统是这类信息最好的归属地
    - 位置标记。如果标记不多也可以用，如果滥用标记就会全部被忽略掉
    - 括号后面的注释。用来解释函数，当发现自己想要在括号后面写注释时，应该做的是缩短函数
    - 注释掉的代码！！！其他人根本不敢删除，注释掉的代码推在一起乱死了。源代码控制系统可以帮我们记住不要的代码
    - 多余的注释、废话、误导性注释、喃喃自语、能用函数或变量就别用注释、信息过多...

## 第5章 格式
- 垂直格式
    单个文件最好大多200行，最多500行
    - 垂直方向上的区隔：封包声明（package）、导入声明、每个函数之间有一空行
    - 垂直方向上的靠近：关系密切的应该相互靠近，注释和变量、函数之间应该靠近
    - 垂直距离：本地变量应该在函数顶部，实体变量在类的顶部，概念相关的代码应该放在一起
    - 垂直顺序：调用者应该尽可能在被调用者上面，建立一种自顶向下贯穿源代码模块的良好信息流

- 横向格式
    代码应该多宽？不必死守80字符，上限120字符即可
    - 水平方向上的区隔与靠近。使用空格将彼密切相关的事物连接到一起，也用空格把相关性较弱的事务分隔开。**赋值语句左右两边加空格**，加强了分隔效果；**运算符左右两边加空格**，加强运算符；函数名和左括号之间不加空格，因为函数与其参数密切相关；把参数一一隔开，强调逗号，表示参数互相分离
    - 水平对齐。对齐一组声明中的变量名，或一组赋值语句的右值，*是没有用的*。对齐像是在强调不重要的东西，忽略真正重要的东西。对齐变量名会忽略掉类型，对齐赋值语句会对运算符视而不见

## 第6章 对象和数据结构
将变量设置为私有有一个理由：不想其他人依赖这些变量，还想心血来潮时自由修改其类型或实现

- 数据抽象。隐藏实现并不是简单的用getter和setter将其变量往外推，也不是变量之间放一个函数层那么简单，而是暴露抽象接口，以便用户无需了解数据的实现就能操作数据本体

## 第7章 错误处理

- 遇到错误最好抛出一个异常，而非返回一个错误码（不抛出异常）。代码整洁，逻辑不混乱

- try...catch...finally...：try就像事务，可随时取消执行

- 给出异常发生的环境说明。应创建信息充分的消息，和异常一起传递出去，包括失败操作和类型

- 依调用者下需要定义异常类别。可依照其来源分类：来自组件还是其他地方？或依其类型分类：设备错误、网络错误还是编程错误

- **别返回NULL值，别传递NULL值**。给调用者添乱，总是在检查NULL值，只要有一处没检查，程序就会失控。以Java为例，如果要返回空的List，应该返回emptyList()

## 第9章 单元测试

- TDD：要求我们在编写生产代码之前先编写单元测试

- 保持测试整洁，测试代码和生产代码一样重要。如果测试不干净，改动自己的代码就有所牵制，测试越脏，代码就会越变越脏。整洁的测试必须具备可读性：明确、简介、足够的表达了，以尽可能少的内容表达大量内容

- 每个测试函数只测一个概念，不需要超长的测试函数

## 第10章 类

- 组织：变量的顺序为：公共静态常量、私有静态变量、私有实体变量，很少有公共变量。公共函数在变量列表之后，把由某个公共函数调用的私有工具函数紧随在该函数之后，符合自顶向下原则